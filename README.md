# This project is a collection of Matlab scripts that handle Compustat data. Contains the following files:

## Main files for general or specific operations.
main.m
Main working file, contains a workflow of loading data and generating some action, such as processing raw compustat data, or running operations such as generating factors.
Main is currently written to load data and run stage1 regressions, but its structure is general in that many of the other scripts maintain a very similar structure.

## Auxiliary files
## A general preabmle script that sets up variables to all direcotries and loads all lightweight auxliary files (for example trading days of NYSE stock market) + metadata for Compustat security level data:
preamble.m
1. company level metadata
2. security level metadata

## Create a dictionary for all variable types.
var_types.m

## the workflow generates several result files, and it is very useful to have a string in the filename specifying the parameters used in production
added_str.m

## function to generate opts for readtable
gen_opts.m


Important global variables:
glob:           either "g" or "na" for global/North American security data (char)
freq:           either "D" or "M: for daily/monthly data (char)
dates_CBS:      for monthly data, end of month based on CPI release data
returns_var:    the variable to use as the definition for returns (e.g. "retd" for daily regular returns, "xretd" for daily excess returns, char)
min_date:       sample start date (datetime)
max_date:       sample end date (datetime)
params:         dict containg current session global parameters (to pass to functions in one object, cotainter.Map object)
factors_tab:    mapping between factor name and the table containing it
load_in_chunks  controls procedure for fast loading of large data (bool)
T               table object containing the main data, usually cross-section security level and some additions
join TS         whether to join time series data to the cross section table, T

## A collection of scripts loading larger non-Compustat data, such as CPI, FX rates, and non-security Compustat data, such as company/security metadata.
load_data.m

load_CPI.m                  Consumer Price Index from BLS
load_currency.m             FX data
load_ex_PI.m                Expected inflation data (Cleveland model + TIPS)
load_Rf.m                   Risk free rate data
load_mkt.m                  Market index data
load_quarterly_reports.m    Quarterly financial reports (selected variables from fundq table)
full_arima.csv              ARMA(1,1) results table (generated by a Python script)
load_gvkeys.m               load security level information (typically from after some processing, sec_proc)
fpath_equity                optional: load security table in one go

## Other load not commonly used
load_fundq.m
load_fundq_all.m
TBill.m  # previously used to compute the risk free rate from raw data.


## script to merge different data loaded to one single table called T
## also computes book/market equity ratio (b2m)
## typically indexed on the primary keys: datadate, iid, cid etc.
merge2T.m

## Largely unused short scripts loaded in preamble directly.
load_company.m
load_security.m
load_sechistory.m

# Merton related scripts
## Scripts to compute Merton distance to default (DD) and compare it to DD from CDS data.
merton_script.m
merton_CDS_script.m

load_merton_CDS.m
load_merton.m

## functions to compute merton using predefined variables as the debt component.
compute_merton_vars.m
compute_merton_CDS_vars.m


## cleans fundq in prep for merton_script.m
fundq.m

## cleans fundq in prep for merton_script.m
fundq_proc.m

## prepare security level data for production, compute returns etc.
secd_proc.m
secm_proc.m


## function to regress firm level returns data on some factor
stage1_reg.m
## function to regress firm level returns data on some factor (moving window)
stage1_reg_mw.m

## loop scipt using stage1_reg.m and plotting/saving results
stage1_regs.m

## loop scipt using stage1_reg_mw.m and plotting/saving results
stage1_regs_mw.m

## functions and loop scripts to calculate the final "factor" from stage1 regressions.
get_factor.m
get_factor_cond.m
get_factors.m
get_factor_wf.m
get_factor_wf_operation.m

get_indices.m
get_weight_index.m

## liquidity related scripts
liquidity_trddays.m
liquidity_amihud.m
liquidity.m


